//
//  FeedCoordinator.swift
//  Navigation
//
//  Created by –£–ª—å–≤–∏ –ü–∞—à–∞–µ–≤ on 09.02.2023.
//

import Foundation
import UIKit

/// FeedCoordinator –ø–æ–º–æ–≥–∞–µ—Ç FeedViewController'—É –≤ –ø–æ–∫–∞–∑–µ –Ω–æ–≤—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤ (—Å–≤–æ–µ–≥–æ —Ä–æ–¥–∞ –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–∫–∞–∑–∞ —ç–∫—Ä–∞–Ω–æ–≤ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ FeedViewController)
class FeedCoordinator: CoordinatorProtocol {
    // MARK: - Properties
    var childs: [CoordinatorProtocol] = []
    
    /// "–≥–ª–∞–≤–Ω—ã–π" –∏–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —ç–∫—Ä–∞–Ω –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–∞.
    /// –≠—Ç–æ –Ω–µ —Ç–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –µ–≥–æ –ø–æ–∫–∞–∑–∞–ª, –∞ —Ç–æ—Ç –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –µ–≥–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å, —Ç–æ –µ—Å—Ç—å:
    /// RootCoorinator.rootVC = RootViewController
    /// LoggedInCoordinator.rootVC = LoggedViewController
    /// —ç—Ç–æ —Ç–æ—Ç —ç–∫—Ä–∞–Ω, –∫–æ—Ç–æ—Ä—ã–π **–¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–ª** —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∫–∞–∑–æ–º –¥—Ä—É–≥–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ –Ω–∞—à–µ–º—É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä—É
    private var rootVC: UIViewController?
    
    /// –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –∫–æ—Ç–æ—Ä–∞—è –¥–µ—Ä–∂–∏—Ç —Å–ª–∞–±—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –¥–æ—á–µ—Ä–Ω–∏–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –Ω–∞—à–µ–≥–æ FeedCoordinator.
    /// –û–Ω–∞ –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è, –∫–æ–≥–¥–∞ –º—ã –∑–∞—Ö–æ—Ç–∏–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å - –ø–æ–∫–∞–∑–∞–Ω –ª–∏ Post —ç–∫—Ä–∞–Ω –∏–ª–∏ –Ω–µ—Ç.
    ///
    /// –ó–∞—Ö–æ—Ç–∏–º –º—ã —ç—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–æ–≥–¥–∞ –Ω–∞–º –Ω–∞–¥–æ –±—É–¥–µ—Ç —É–¥–∞–ª–∏—Ç—å —ç–∫—Ä–∞–Ω –∏–∑ –ø–∞–º—è—Ç–∏(–∫–æ–≥–¥–∞ –æ–Ω –∑–∞–∫—Ä–æ–µ—Ç—Å—è)
    /// –ï—Å–ª–∏ —É –Ω–∞—Å –Ω–µ –±—É–¥–µ—Ç —ç—Ç–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, —Ç–æ –º—ã —Å–º–æ–∂–µ–º –Ω–∞–π—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–æ—á–µ—Ä–Ω–∏–π —ç–∫—Ä–∞–Ω –≤ –º–∞—Å—Å–∏–≤–µ childs
    /// –ü–æ—á–µ–º—É –Ω–µ —Å–º–æ–∂–µ–º? - —Ç–∞–º –ª–µ–∂–∞—Ç –æ–±—ä–µ–∫—Ç—ã CoordinatorProtocol (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª), –∞ –Ω–µ FeedCoordinator –∏–ª–∏ PostCoordinator (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª–∞—Å—Å—ã) –∏ —Ç.–¥.
    /// –û–±—â–µ–Ω–∏–µ —É –Ω–∞—Å –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —Å –Ω–∏–º–∏ **—Ç–æ–ª—å–∫–æ** –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É
    /// –í –æ–±—â–µ–º, –¥–ª—è –Ω–∞—Å –Ω–∞ –ø–µ—Ä–≤—ã–π –≤–∑–≥–ª—è–¥ –æ–Ω–∏ –±—É–¥—É—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ - –≤—Å–µ CoordinatorProtocol
    /// –ò –≤–æ—Ç —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—ã–π(–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π) –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä, –º—ã –¥–µ—Ä–∂–∏–º —Å—Å—ã–ª–∫—É –Ω–∞ post, –∞ –∑–∞—Ç–µ–º –ø—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ –º–∞—Å—Å–∏–≤–∞ childs,
    /// –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ –∞–¥—Ä–µ—Å—É –ø–∞–º—è—Ç–∏ –∫–∞–∂–¥—ã–π —ç–∫—Ä–∞–Ω - –∫–æ–≥–¥–∞ –Ω–∞–π–¥–µ–º —Å–æ–æ—Ç–≤–µ—Ç–≤—É—é—â–∏–π –∞–¥—Ä–µ—Å - —É–¥–∞–ª–∏–º –µ–≥–æ –∏–∑ –º–∞—Å—Å–∏–≤–∞
    ///
    /// —Å–ª–∞–±–∞—è —Å—Å—ã–ª–∫–∞ –Ω—É–∂–Ω–∞ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –º—ã –º–æ–≥–ª–∏ –ª–µ–≥–∫–æ —É–¥–∞–ª–∏—Ç—å –¥–æ—á–µ—Ä–Ω–∏–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –∏–∑ –º–∞—Å—Å–∏–≤–∞ childs.
    
    private weak var post: PostCoordinator?
    
    // MARK: - Methods
    /// —Ç–∞–∫–∂–µ –∫–∞–∫ –∏ –≤ RootCoordinator - —Å–æ–±–∏—Ä–∞–µ–º —Ç–æ, —á—Ç–æ —Ö–æ—Ç–∏–º —É–≤–∏–¥–µ—Ç—å (—Ç–æ—Ç —ç–∫—Ä–∞–Ω, –∫–æ—Ç–æ—Ä–æ–º—É –ø–æ–º–æ–≥–∞–µ—Ç –Ω–∞—à –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä)
    func build() -> UIViewController {
        logACtivate()
        let feedVC = FeedViewController() // —Å–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä —ç–∫—Ä–∞–Ω–∞
        feedVC.coordinator = self // –≥–æ–≤–æ—Ä–∏–º —ç–∫—Ä–∞–Ω—É, —á—Ç–æ –µ–º—É –ø–æ–º–æ–≥–∞–µ—Ç –Ω–∞—à –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä
        rootVC = feedVC // —Ç–∞–∫ –∫–∞–∫ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–∞ FeedVC - –¥–µ–ª–∞–µ–º –µ–≥–æ rootVC. (—Å–º. –æ–ø–∏—Å–∞–Ω–∏–µ rootVCüëÜ)
        
        /// —Ç–∞–∫ –∫–∞–∫ –º—ã —Ö–æ—Ç–∏–º, —á—Ç–æ–±—ã –Ω–∞—à FeedVC –±—ã–ª –∑–∞–≤–µ—Ä–Ω—É—Ç –≤–Ω—É—Ç—Ä—å NavigationVC - –¥–µ–ª–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä NavigationVC - –¥–µ–ª–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä NavigationVC
        /// –∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ rootViewController —É–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—à FeedVC
        /// —Ç–æ –µ—Å—Ç—å –æ–±—ã—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ UINavigationController
        let navigationController = UINavigationController.init(rootViewController: feedVC)
        return navigationController
    }
    
    
    /// –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –Ω—É–∂–Ω–∞ –Ω–∞—à–µ–º—É FeedVC, –∫–æ—Ç–æ—Ä–æ–º—É –º—ã –ø–æ–º–æ–≥–∞–µ–º –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —ç–∫—Ä–∞–Ω—ã.
    /// –ö–æ–≥–¥–∞ FeedVC –∑–∞—Ö–æ—á–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É) - –æ–Ω –æ–±—Ä–∞—Ç–∏—Ç—Å—è –∫ –Ω–∞–º –∏ –ø–æ–ø—Ä–æ—Å–∏—Ç –ø–æ–∫–∞–∑–∞—Ç—å –¥–ª—è –Ω–µ–≥–æ PostScreen
    /// –¢—É—Ç —Ç–æ —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –∏ —Å–¥–µ–ª–∞–µ—Ç –≤—Å—é –≥—Ä—è–∑–Ω—É—é —Ä–∞–±–æ—Ç–∞ –∑–∞ FeedVC - —Å–æ–∑–¥–∞—Ç –Ω–æ–≤—ã–π —ç–∫—Ä–∞–Ω, —Å–æ–∑–¥–∞—Ç –Ω–æ–≤—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –∫ –Ω–µ–º—É –∏ —Ç.–¥.
    func showPostScreen(title: String) {
        let coordinator = PostCoordinator() // —Å–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä PostCoordinator(—Å–º. –∞–∫—Å–∏–æ–º—É –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –≤ RootCoordinator'e)
        
        ///–≥–æ–≤–æ—Ä–∏–º –Ω–æ–≤–æ–º—É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä—É, —á—Ç–æ –º—ã —è–≤–ª—è–µ–º—Å—è –µ–≥–æ —Å–ª—É—à–∞—Ç–µ–ª–µ–º
        ///–≠—Ç–æ –Ω–∞–¥–æ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∫–æ–≥–¥–∞ —ç–∫—Ä–∞–Ω Post –∑–∞–∫—Ä–æ–µ—Ç—Å—è, PostCoordinator –Ω–∞–º –æ–± —ç—Ç–æ–º —Å–æ–æ–±—â–∏–ª –∏ –º—ã –º–æ–≥–ª–∏ –æ—á–∏—Å—Ç–∏—Ç—å –ø–∞–º—è—Ç—å
        ///—ç—Ç–æ –ø—Ä–∏–º–µ—Ä –æ—Ç–Ω–æ—à–µ–Ω–∏–π –æ—Ç –¥–æ—á–µ—Ä–Ω–µ–≥–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–∞ –∫ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º—É:
        ///–¥–æ—á–µ—Ä–Ω–∏–π -> —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π
        coordinator.listener = self
        
        let postVC = coordinator.build(title: title) // —Å–æ–∑–¥–∞–µ–º PostViewController
        /// –ø—Ä–∏—Å–≤–∞–µ–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π post (—Å–º. –≤—ã—à–µ) —Å—Å—ã–ª–∫—É –Ω–∞ –Ω–∞—à–µ–≥–æ –Ω–æ–≤–æ–≥–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–∞
        /// –≥–æ–≤–æ—Ä–∏–º, —á—Ç–æ –Ω–∞—à —ç–∫—Ä–∞–Ω Post - –ø–æ–∫–∞–∑–∞–Ω
        post = coordinator
        attachChild(coordinator) // –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –≤ –º–∞—Å—Å–∏–≤ childs —É FeedCoordinator
        rootVC?.navigationController?.pushViewController(postVC, animated: true) // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º PostVC, –∏—Å–ø–æ–ª—å–∑—É—è rootVC (–≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ - —ç—Ç–æ FeedVC, —Å–º. —Ñ—É–Ω–∫—Ü–∏—é build)
    }
}

/// extension –∫ FeedCoordinator, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç –µ–≥–æ –ø–æ–¥ –ø—Ä–æ—Ç–æ–∫–æ–ª —Å–ª—É—à–∞—Ç–µ–ª—è PostCoordinator
/// PostCoordinatorListener –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ PostCoordinator
/// –≠—Ç–æ –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –æ–±—â–µ–Ω–∏—è **–¥–æ—á–∫–∞ -> —Ä–æ–¥–∏—Ç–µ–ª—å**
extension FeedCoordinator: PostCoordinatorListener {
    ///PostCoordinator –≤—ã–∑–æ–≤–µ—Ç —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ–≥–¥–∞ –æ–Ω –∑–∞–∫—Ä–æ–µ—Ç—Å—è –∏ –º—ã –æ–± —ç—Ç–æ–º **—É–∑–Ω–∞–µ–º**
    ///–ö–æ–≥–¥–∞ –æ–Ω–∞ –≤—ã–∑–æ–≤–µ—Ç—Å—è - –º—ã —É–¥–∞–ª–∏–º –µ–≥–æ –∏–∑ –ø–∞–º—è—Ç–∏ FeedCoordinator - –∏–∑ –º–∞—Å—Å–∏–≤–∞ childs
    func postDidClose() {
        guard let post = post else { return }
        detachChild(post) // —É–¥–∞–ª—è–µ–º post –∏–∑ –º–∞—Å—Å–∏–≤–∞ childs. 
    }
}
